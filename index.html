<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>러셀 이동일지 작성</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        h1 { color: #336699; font-size: 24px; }
        form {
            display: inline-block; text-align: left; border: 1px solid #ccc;
            padding: 20px; width: 100%; max-width: 500px; box-sizing: border-box;
            background-color: #f9f9f9; border-radius: 8px;
        }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        select, textarea {
            width: 100%; padding: 12px; margin-bottom: 15px; box-sizing: border-box;
            font-size: 16px; border-radius: 4px; border: 1px solid #ccc;
        }
        button {
            padding: 10px 20px; background-color: #336699; color: #fff;
            border: none; cursor: pointer; width: 100%; max-width: 120px; border-radius: 4px;
        }
        button:hover { background-color: #28597b; }
        #resetButton {
            margin: 10px 0; float: left; width: auto; padding: 8px 16px;
            background-color: #ccc; cursor: pointer;
        }
        table {
            margin: 20px auto; border-collapse: collapse; width: 100%; max-width: 700px;
            border-radius: 8px; overflow: hidden;
        }
        th, td { border: 1px solid #ccc; padding: 12px; text-align: center; }
        thead { background-color: #f2f2f2; font-weight: bold; }
        tbody tr:nth-child(even) { background-color: #f9f9f9; }
        tbody tr:hover { background-color: #f1f1f1; }
        
        .error {
            color: red; margin-top: 10px; display: none; font-weight: bold;
        }
        .score { display: none; }

        @media (max-width: 768px) {
            form { padding: 15px; }
            button { width: 100%; }
            table, th, td { font-size: 14px; }
            select, textarea { padding: 14px; font-size: 18px; }
        }
    </style>
</head>
<body>
    <h1>러셀 이동일지&교육점수 작성</h1>
    <button id="resetButton" onclick="resetTable()">테이블 초기화</button>

    <form id="moveForm">
        <label for="building">관:</label>
        <select id="building" required>
            <option value="">선택하세요</option>
            <option value="4-1관">4-1관</option>
            <option value="4-2관">4-2관</option>
            <option value="4-3관">4-3관</option>
            <option value="4-4관">4-4관</option>
            <option value="4-5관">4-5관</option>
        </select>

        <label>좌석번호:</label>
        <div style="display: flex; gap: 10px;">
            <select id="seatNumber" required>
                <option value="">선택</option>
                <option value="A">A</option><option value="B">B</option><option value="C">C</option>
                <option value="D">D</option><option value="F">F</option><option value="G">G</option>
                <option value="H">H</option><option value="I">I</option>
            </select>
            <select id="seatNumber2" required>
                <option value="">선택</option>
                <option value="01">01</option><option value="02">02</option><option value="03">03</option>
                <option value="04">04</option><option value="05">05</option><option value="06">06</option>
                <option value="07">07</option><option value="08">08</option><option value="09">09</option>
                <option value="10">10</option><option value="11">11</option>
            </select>
        </div>

        <label for="reason">이동사유:</label>
        <select id="reason" required>
            <option value="">선택하세요</option>
            <optgroup label="일반 이동">
                <option value="화장실/정수기">화장실/정수기</option>
                <option value="튜터 질의응답">튜터 질의응답</option>
                <option value="외부 학원/과외/보충">외부 학원/과외/보충</option>
                <option value="자료수령">자료수령</option>
                <option value="가족 행사">가족 행사</option>
                <option value="병원">병원</option>
                <option value="식사">식사</option>
                <option value="기타">기타</option>
                <option value="조퇴(컨디션난조)">조퇴(컨디션난조)</option>
            </optgroup>
            <optgroup label="규정 위반/지도">
                <option value="지각">지각</option>
                <option value="입/퇴실 미준수">입/퇴실 미준수</option>
                <option value="핸드폰 미제출">핸드폰 미제출</option>
                <option value="전자기기 무단사용">전자기기 무단사용</option>
                <option value="핸드폰 무단사용">핸드폰 무단사용</option>
                <option value="무단이탈">무단이탈</option>
                <option value="타층/타관 무단출입">타층/타관 무단출입</option>
                <option value="핸드폰/Wifi 무단반입">핸드폰/Wifi 무단반입</option>
                <option value="무단결석">무단결석</option>
                <option value="원내대화">원내대화</option>
                <option value="무단지각">무단지각</option>
                <option value="취침강제하원">취침강제하원</option>
                <option value="음식물섭취">음식물섭취</option>
            </optgroup>
        </select>

        <label for="returnTime">복귀교시:</label>
        <select id="returnTime" required>
            <option value="">선택하세요</option>
            <option value="1">1교시</option><option value="2">2교시</option>
            <option value="3">3교시</option><option value="4">4교시</option>
            <option value="5">5교시</option><option value="6">6교시</option>
            <option value="7">7교시</option><option value="8">8교시</option>
            <option value="복귀안함">복귀안함</option>
        </select>

        <div id="scoreDiv" class="score">
            <label for="score">점수 (1~10점):</label>
            <select id="score">
                <option value="1">1점</option><option value="2">2점</option>
                <option value="3">3점</option><option value="4">4점</option>
                <option value="5">5점</option><option value="6">6점</option>
                <option value="7">7점</option><option value="8">8점</option>
                <option value="9">9점</option><option value="10">10점</option>
            </select>
        </div>

        <label for="otherReason" id="otherReasonLabel" style="display:none;">기타 사유:</label>
        <textarea id="otherReason" placeholder="기타 사유를 입력하세요" style="display:none; height: 100px;"></textarea>
        <div class="error" id="errorMessage">기타 사유를 입력해주세요.</div>

        <button type="submit" style="margin-top: 10px;">제출</button>
    </form>

    <div id="result">
        <table id="moveList">
            <thead>
                <tr>
                    <th>관</th>
                    <th>좌석번호</th>
                    <th>이동사유</th>
                    <th>복귀교시</th>
                    <th>날짜</th>
                    <th>시간</th>
                    <th>점수</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
    let moveList = [];

    const fixedScores = {
        "무단이탈": 10, "전자기기 무단사용": 10, "핸드폰/Wifi 무단반입": 10,
        "핸드폰 무단사용": 7, "무단결석": 7, "타층/타관 무단출입": 5,
        "원내대화": 5, "무단지각": 5, "취침강제하원": 3, "음식물섭취": 3,
        "입/퇴실 미준수": 3, "핸드폰 미제출": 10,
    };

    const scoreReasons = Object.keys(fixedScores);

    document.getElementById("reason").addEventListener("change", function() {
        const value = this.value;
        const isScoreReason = scoreReasons.includes(value);
        
        document.getElementById("scoreDiv").style.display = isScoreReason ? "block" : "none";
        
        if (value === "기타") {
            document.getElementById("otherReason").style.display = "block";
            document.getElementById("otherReasonLabel").style.display = "block";
        } else {
            document.getElementById("otherReason").style.display = "none";
            document.getElementById("otherReasonLabel").style.display = "none";
            document.getElementById("errorMessage").style.display = "none";
        }

        if (fixedScores[value]) {
            document.getElementById("score").value = fixedScores[value];
        }
    });

    document.getElementById("moveForm").addEventListener("submit", function(event) {
        event.preventDefault();

        const building = document.getElementById("building").value;
        const seatNumber = document.getElementById("seatNumber").value + document.getElementById("seatNumber2").value;
        const reason = document.getElementById("reason").value;
        const returnTime = document.getElementById("returnTime").value;
        const otherReason = document.getElementById("otherReason").value;
        const score = parseInt(document.getElementById("score").value) || null;

        if (reason === "기타" && !otherReason.trim()) {
            document.getElementById("errorMessage").style.display = "block";
            return;
        }

        submitMoveData(building, seatNumber, returnTime, reason, otherReason, score);
    });

    function submitMoveData(building, seatNumber, returnTime, reason, otherReason, score) {
        const now = new Date();
        const inputDate = now.toISOString().split('T')[0];
        const inputTime = now.toTimeString().split(' ')[0];

        const moveData = {
            building,
            seatNumber,
            returnTime: returnTime === "복귀안함" ? "복귀안함" : returnTime + "교시",
            reason: reason === "기타" ? otherReason : reason,
            score: scoreReasons.includes(reason) ? score : null,
            inputDate,
            inputTime
        };

        moveList.unshift(moveData); // 최신순 정렬
        refreshMoveList();

        // 폼 초기화
        document.getElementById("moveForm").reset();
        document.getElementById("scoreDiv").style.display = "none";
        document.getElementById("otherReason").style.display = "none";
        document.getElementById("otherReasonLabel").style.display = "none";

        // 서버 전송 (기존 URL 유지)
        fetch('https://script.google.com/macros/s/AKfycbyO3_XoamjQF9F7pRazW9L_3P0TqEGH1pg2373ifiob9GJKwfjqV35f0KF053NHElyz/exec', {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify(moveData)
        });
    }

    function refreshMoveList() {
        const tableBody = document.querySelector("#moveList tbody");
        tableBody.innerHTML = "";
        moveList.forEach(data => {
            const row = `<tr>
                <td>${data.building}</td>
                <td>${data.seatNumber}</td>
                <td>${data.reason}</td>
                <td>${data.returnTime}</td>
                <td>${data.inputDate}</td>
                <td>${data.inputTime}</td>
                <td>${data.score || '-'}</td>
            </tr>`;
            tableBody.innerHTML += row;
        });
    }

    function resetTable() {
        if(confirm("기록을 모두 삭제하시겠습니까?")) {
            moveList = [];
            refreshMoveList();
        }
    }
    </script>
</body>
</html>

